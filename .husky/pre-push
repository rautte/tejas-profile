#!/usr/bin/env bash
set -euo pipefail
[ -f .env.local ] && set -a && . ./.env.local && set +a

echo "[pre-push] syncing heavy assets to S3…"
if ! npm run -s sync:assets; then
  echo "[pre-push] WARN: asset sync failed — continuing push (you can run 'npm run assets:push' later)."
  exit 0
fi

echo "[pre-push] invalidating CloudFront…"
npm run -s cdn:invalidate || echo "[pre-push] WARN: CDN invalidation failed — run 'npm run cdn:invalidate' later."

echo "[pre-push] done ✓"
